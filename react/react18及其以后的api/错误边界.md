# 错误边界（Error Boundary） 16 之后的功能

- 是 React 提供的一种机制，用于捕获组件树中子组件渲染、生命周期和构造函数中的错误，从而防止整个 React 应用崩溃。

# 范围

- 渲染阶段错误（render）
- 生命周期方法错误（例如 componentDidMount、componentDidUpdate）
- 构造函数错误

## 错误边界 不能捕获：

- 事件处理函数（Event Handler）中的错误 → 需要 try/catch 或全局 window.onerror
- 异步代码中的错误（setTimeout、Promise）
- 服务端渲染（SSR）中的错误
- 错误边界自身的错误

# 怎么使用

Hooks 组件无法直接作为错误边界，必须使用类组件
如果想在函数组件里使用错误边界，可以包一层类组件或者使用第三方库（如 react-error-boundary）

# 一个具体的代码

```jsx
import React from "react";

// 1. 定义错误边界
class ErrorBoundary extends React.Component<
  { fallback?: React.ReactNode },
  { hasError: boolean }
> {
  constructor(props: any) {
    super(props);
    this.state = { hasError: false };
  }

  // 当子组件报错时，更新 state
  static getDerivedStateFromError(error: Error) {
    return { hasError: true };
  }

  // 错误日志上报
  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error("Caught by ErrorBoundary:", error, errorInfo);
    // 可以上报到服务器
    // sendError({ message: error.message, stack: error.stack, extra: JSON.stringify(errorInfo) });
  }

  render() {
    if (this.state.hasError) {
      // 渲染备用 UI
      return this.props.fallback || <h2>出错了，请刷新页面</h2>;
    }
    return this.props.children;
  }
}

export default ErrorBoundary;

<ErrorBoundary fallback={<div>加载出错</div>}>
  <SomeComponent />
</ErrorBoundary>;
```
