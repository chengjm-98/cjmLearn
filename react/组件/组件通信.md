# 父子组件

- props
- context

  ## 父组件想要调用子组件的方法
  - 父组件通过 ref 获取子组件实例
  - 子组件通过 useImperativeHandle 暴露方法给父组件
  - 父组件通过 ref.current 调用子组件方法

# 子父组件

- 回调函数

# 兄弟

- 父组件中转
- context

# 跨组件

- 全局的context
- 状态管理库 mobx
- 自定义hook来封装发布订阅事件总线

# 详细介绍一下发布总线的实现方式

- 全局创建一个类，eventBus

```js
// eventBus.ts
type Handler<T = any> = (data: T) => void

class EventBus {
  private events: Record<string, Handler[]> = {}

  // 订阅事件
  subscribe<T = any>(eventName: string, handler: Handler<T>) {
    if (!this.events[eventName]) {
      this.events[eventName] = []
    }
    this.events[eventName].push(handler)
  }

  // 发布事件
  publish<T = any>(eventName: string, data?: T) {
    const handlers = this.events[eventName]
    if (!handlers) return
    handlers.forEach(fn => fn(data))
  }

  // 取消订阅
  unsubscribe<T = any>(eventName: string, handler: Handler<T>) {
    const handlers = this.events[eventName]
    if (!handlers) return
    this.events[eventName] = handlers.filter(fn => fn !== handler)
  }

  // 清空所有事件
  clear() {
    this.events = {}
  }
}

export default new EventBus()
```

- 自定义hook封装

```js
// useEventBus.ts
import { useEffect } from 'react'
import EventBus from './eventBus'

export function useEventBus<T = any>(eventName: string, handler: (data: T) => void) {
  useEffect(() => {
    EventBus.subscribe(eventName, handler)
    return () => {
      EventBus.unsubscribe(eventName, handler)
    }
  }, [eventName, handler])
}
```

- 组件中使用
- 组件a发布

  ```jsx
  import EventBus from "./eventBus";

  function ComponentA() {
    const handleClick = () => {
      EventBus.publish("login", { name: "Tom", role: "admin" });
    };

    return <button onClick={handleClick}>登录</button>;
  }
  ```

- 组件b订阅

```jsx
import { useEventBus } from "./useEventBus";

function ComponentB() {
  useEventBus("login", (user) => {
    console.log("收到登录信息:", user);
  });

  return <div>Component B</div>;
}
```
