# ä»€ä¹ˆæ—¶å€™ç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“ï¼Ÿ

## 1.ç»„ä»¶çš„ props å‘ç”Ÿå˜åŒ–

- propsæ˜¯æµ…å¼•ç”¨ï¼Œå¦‚æœæ˜¯åŸºç¡€æ•°æ®ç±»å‹ï¼Œé‚£ä¹ˆå€¼å‘ç”Ÿå˜åŒ–å°±ä¼šå˜åŒ–
- propsæ˜¯å¼•ç”¨ç±»å‹ï¼Œé‚£ä¹ˆå¼•ç”¨åœ°å€å‘ç”Ÿå˜åŒ–å°±ä¼šå˜åŒ–

## 2.ç»„ä»¶çš„ state å‘ç”Ÿå˜åŒ–

å½“ç»„ä»¶å†…éƒ¨é€šè¿‡ setState æ–¹æ³•æ›´æ–°çŠ¶æ€æ—¶ï¼Œç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“ã€‚ï»¿
åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œé€šè¿‡ useState hook æ›´æ–°çŠ¶æ€ä¹Ÿä¼šè§¦å‘é‡æ–°æ¸²æŸ“ã€‚ï»¿
React å¯èƒ½ä¼šå¯¹å¤šä¸ª setState æ“ä½œè¿›è¡Œæ‰¹é‡å¤„ç†ä»¥ä¼˜åŒ–æ€§èƒ½ï¼Œæ‰€ä»¥çŠ¶æ€çš„æ”¹å˜ä¸ä¸€å®šä¼šç«‹å³å¯¼è‡´ render æ–¹æ³•çš„è°ƒç”¨ã€‚ï»¿
React å¼•å…¥äº† æ‰¹å¤„ç†ï¼ˆbatchingï¼‰æœºåˆ¶ï¼Œå³ React ä¼šå°†å¤šä¸ª setState() è°ƒç”¨åˆå¹¶æˆä¸€æ¬¡æ›´æ–°ï¼Œä»¥æé«˜æ€§èƒ½ã€‚

---

- ### ğŸ§ª æ‰¹å¤„ç† ï¼ˆè§£é‡Šä¸€ä¸‹æ‰¹å¤„ç†æœºåˆ¶ï¼‰
- æœ‰å¥è¯æ¦‚æ‹¬å¾—å¾ˆå¥½ï¼šæ‰¹å¤„ç†åœ¨æ•°æ®å±‚å°†å¤šä¸ªçŠ¶æ€æ›´æ–°æ‰¹é‡å¤„ç†ï¼Œåˆå¹¶æˆä¸€æ¬¡æ›´æ–°ï¼›åœ¨è§†å›¾å±‚å°†å¤šä¸ªæ¸²æŸ“åˆå¹¶æˆä¸€æ¬¡æ¸²æŸ“ã€‚

---

**è¿™é‡Œæä¸€ä¸ªé—®é¢˜ï¼Ÿ**

Q:ç”±äºæ‰¹é‡å¤„ç†è¿™ä¸ªæœºåˆ¶ï¼Œæ‰€ä»¥å‡å¦‚ä½ æƒ³è¦é€šè¿‡æ›´æ–° state æ¥å®ç°ç»„ä»¶çš„å¼ºåˆ¶æ›´æ–°ï¼Œå…¶å®ä¹Ÿä¸å¯è¡Œå¯¹å§ï¼Œå› ä¸ºå®ƒä¸æ˜¯å®æ—¶çš„ã€‚

A:React ä¸­è°ƒç”¨ setStateï¼ˆæˆ– useState çš„æ›´æ–°å‡½æ•°ï¼‰å¹¶ä¸ä¼šç«‹å³æ›´æ–°ç»„ä»¶ï¼Œä¹Ÿä¸ä¼šç«‹å³è§¦å‘ renderï¼Œæ‰€ä»¥å®ƒä¸èƒ½ç”¨äºâ€œç«‹å³å¼ºåˆ¶æ›´æ–°â€ç»„ä»¶ã€‚

**è§£å†³åŠæ³•ï¼Œå‡å¦‚ä¸€å®šè¦å¼ºåˆ¶æ›´æ–°å‘¢**

React 18 æ–°å¢çš„ flushSyncï¼ˆæ¥è‡ª react-domï¼‰

todo:éœ€è¦æ·±å…¥ç†è§£ä¸€ä¸‹

```jsx
import { flushSync } from "react-dom";

flushSync(() => {
  setCount(count + 1); // ä¼šç«‹å³åŒæ­¥æ›´æ–°å¹¶è§¦å‘ render
});
```

## 3.ç»„ä»¶çš„çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“

å½“ç»„ä»¶çš„çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œå¦‚æœä¸åšä»»ä½•ä¼˜åŒ–ï¼Œé‚£ä¹ˆå­ç»„ä»¶ä¹Ÿä¼šé‡æ–°æ¸²æŸ“ã€‚

**è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæƒ³è¦é¿å…å­ç»„ä»¶çš„æ²¡å¿…è¦çš„æ¸²æŸ“ï¼Œéœ€è¦ä½¿ç”¨ React.memo()åŒ…è£¹å­ç»„ä»¶ï¼Œæˆ–è€…ä½¿ç”¨ shouldComponentUpdate()æ–¹æ³•è¿›è¡Œä¼˜åŒ–ã€‚**

react.memo() æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œå®ƒä¼šå¯¹ç»„ä»¶è¿›è¡Œæµ…æ¯”è¾ƒï¼Œå¦‚æœ props æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆç»„ä»¶å°±ä¸ä¼šé‡æ–°æ¸²æŸ“ã€‚ä½†æ˜¯å…¶å® props æœ¬èº«ä¹Ÿæ˜¯è¿™ä¸ªæ¯”è¾ƒé€»è¾‘
å®ƒé€‚ç”¨çš„æƒ…å†µæ˜¯åˆ«çš„ state å¯¼è‡´çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œä½†æ˜¯ props æ²¡æœ‰å˜åŒ–çš„æƒ…å†µã€‚å¦‚æœæ²¡æœ‰åŠ  memoï¼Œé‚£ä¹ˆå­ç»„ä»¶ä¹Ÿä¼šé‡æ–°æ¸²æŸ“ã€‚ä½†æ˜¯å¦‚æœåŠ äº† memoï¼Œé‚£ä¹ˆå­ç»„ä»¶å°±ä¸ä¼šé‡æ–°æ¸²æŸ“ã€‚

## 4.ä¸Šä¸‹æ–‡çš„ Provider çš„å€¼å‘ç”Ÿå˜åŒ–ï¼ˆuseContextï¼‰

## 5.å¼ºåˆ¶é‡æ–°æ¸²æŸ“ï¼ˆç±»ç»„ä»¶ï¼‰

\*\*è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦ä½¿ç”¨ forceUpdate()æ–¹æ³•è¿›è¡Œå¼ºåˆ¶é‡æ–°æ¸²æŸ“ã€‚

---

## 6.å¼ºåˆ¶é‡æ–°æ¸²æŸ“ï¼ˆå‡½æ•°ç»„ä»¶ï¼‰react18+ç‰ˆæœ¬åæ‰æœ‰

flushSync() å¯ä»¥ç”¨äºå¼ºåˆ¶é‡æ–°æ¸²æŸ“å‡½æ•°ç»„ä»¶ã€‚ä¸ä¼šå—æ‰¹å¤„ç†ç­‰çš„å½±å“

ä½¿ç”¨ flushSync æ—¶ï¼Œæ›´æ–°ä¼šè¢«ç«‹å³æ‰§è¡Œï¼Œé¡µé¢ä¼šåœ¨è°ƒç”¨æ—¶ç«‹åˆ»åæ˜ å‡ºæœ€æ–°çš„çŠ¶æ€ã€‚

å®ƒæ˜¯å¼ºåˆ¶åŒæ­¥æ›´æ–°çš„å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥ç¡®ä¿æŸäº› UI æ“ä½œåœ¨çŠ¶æ€æ›´æ–°åç«‹åˆ»æ¸²æŸ“ã€‚

- ä½¿ç”¨æ–¹æ³•ï¼š

```jsx
import React, { useState } from "react";
import { flushSync } from "react-dom";

function ImmediateUpdate() {
  const [count, setCount] = useState(0);

  const handleClick = () => {
    // å¼ºåˆ¶åŒæ­¥æ›´æ–°
    flushSync(() => {
      setCount(count + 1); // æ›´æ–°çŠ¶æ€
    });
    // React ä¼šç«‹å³æ¸²æŸ“
    console.log("å½“å‰è®¡æ•°ï¼š", count); // è¾“å‡ºä¼šæ˜¯æ›´æ–°åçš„å€¼
  };

  return (
    <div>
      <p>è®¡æ•°: {count}</p>
      <button onClick={handleClick}>å¢åŠ è®¡æ•°</button>
    </div>
  );
}
```

# state

- ğŸ“· **å¿«ç…§**
  - **åœ¨ React çš„ä¸€æ¬¡æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼ˆä¹Ÿå°±æ˜¯ä¸€æ¬¡å‡½æ•°ç»„ä»¶çš„æ‰§è¡Œï¼‰ï¼Œstate çš„å€¼æ˜¯å›ºå®šçš„å¿«ç…§ï¼ˆsnapshotï¼‰ã€‚**

è¿™æ„å‘³ç€ï¼Œåœ¨è¿™æ¬¡æ¸²æŸ“å‡½æ•°å¼€å§‹åˆ°ç»“æŸçš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œstate ä¸ä¼šå› ä¸º setState è°ƒç”¨è€Œç«‹å³æ›´æ–°
å³ä½¿ä½ åœ¨ä¸€æ¬¡æ¸²æŸ“ä¸­å¤šæ¬¡è°ƒç”¨ setStateï¼Œè¿™äº›æ›´æ–°ä¹Ÿåªæ˜¯è¢« è°ƒåº¦ï¼Œä¸ä¼šå½±å“å½“å‰æ¸²æŸ“ä¸­çš„ state å€¼ï¼Œè€Œä¼šåœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“ä¸­ä½“ç°ã€‚

- ğŸŒ°**ä¸¾ä¸ªæ —å­**

```jsx
export default function Counter() {
  const [count, setCount] = React.useState(0);

  console.log("render:", count);

  return (
    <button
      onClick={() => {
        setCount(count + 1);
        setCount(count + 1);
        setCount(count + 1);
      }}
    >
      +3
    </button>
  );
}
```

```
ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œè°ƒç”¨äº†ä¸‰æ¬¡ setCountï¼Œä½†æ˜¯åœ¨æ§åˆ¶å°ä¸­åªä¼šè¾“å‡ºä¸€æ¬¡ render: 0ã€‚è¿™æ˜¯å› ä¸ºåœ¨ React çš„ä¸€æ¬¡æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œstate çš„å€¼æ˜¯å›ºå®šçš„å¿«ç…§ã€‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç¬¬ä¸€æ¬¡æ¸²æŸ“                 â”‚
â”‚                                             â”‚
â”‚  1. React è°ƒç”¨ç»„ä»¶å‡½æ•° Counter()             â”‚
â”‚     â”œâ”€â”€ è¯»å– state: count = 0 (å¿«ç…§)         â”‚
â”‚     â”œâ”€â”€ render è¾“å‡º UI                      â”‚
â”‚                                             â”‚
â”‚  2. ç”¨æˆ·ç‚¹å‡»æŒ‰é’®                            â”‚
â”‚     â”œâ”€â”€ setCount(count + 1)  // 0 + 1 = 1   â”‚
â”‚     â”œâ”€â”€ setCount(count + 1)  // 0 + 1 = 1   â”‚
â”‚     â”œâ”€â”€ setCount(count + 1)  // 0 + 1 = 1   â”‚
â”‚     â”‚                                       â”‚
â”‚     â””â”€â”€ æ‰€æœ‰æ›´æ–°è¢«æ‰¹å¤„ç† â†’ æœ€ç»ˆæ–°å€¼ = 1      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“ï¼ˆè°ƒåº¦ä¸‹ä¸€æ¬¡æ¸²æŸ“ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç¬¬äºŒæ¬¡æ¸²æŸ“                 â”‚
â”‚                                             â”‚
â”‚  1. React è°ƒç”¨ç»„ä»¶å‡½æ•° Counter()             â”‚
â”‚     â”œâ”€â”€ è¯»å– state: count = 1 (æ–°å¿«ç…§)       â”‚
â”‚     â”œâ”€â”€ render è¾“å‡º UI                      â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- ğŸ€**å¿«ç…§çš„åŸç†**
  æ›´å¤šå†…å®¹éœ€è¦çœ‹ hooks
