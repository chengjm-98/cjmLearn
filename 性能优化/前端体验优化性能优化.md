# 资源层面

- 图片优化（WebP / AVIF、响应式图片）
- 使用cdn加速
- 组件模块化

## webpack打包

- tree shaking，去除无用代码
- 压缩
- 分包，避免将大依赖打进首包
- 代码分割（路由 / 组件级）
- 按需加载，比如echart
- 预加载 / 预取（prefetch / preload） --魔法注释
- 构建缓存（cache-loader / filesystem cache）

# 首屏优化

- 图片懒加载 intersectionObserver getBoundingClientRect
- 骨架屏
- 预加载
  - link 预加载< preload 和 prefetch > 首屏 js/首屏 css/首屏图片/字体等
  - 路由预加载，在用户真正进入路由之前，把 JS 先下载好
  - 数据预加载，比如接口什么的
  - webpack预加载（魔法注释）不要大量用
  - quickline 等工具
- ssr 浏览器渲染

# 代码层面

- 防抖节流
- 使用一些transform防止重绘重排
- 使用webworker 处理一些复杂的计算
- requestAnimationFrame 动画控制渲染频率和时机
- react合理使用useMemo useCallback react.memo useRef
- 合理使用key
- suspense+lazy 在组件未加载成功之前展示后备方案
- 合理使用abortController，切换页面什么的时候，abort 掉，取消加载
- 合理使用startTransition 降低非紧急更新优先级
- 注意内存泄漏等问题
  - 定时器/事件清除
  - 注意闭包的使用

# 大文件/长列表

- 分片上传
  - http range
- 流式渲染
  - 使用fetch api + ReadableStream
- 虚拟列表+懒加载+缓冲区
  - scrollTop + clientHeight ≥ scrollHeight
  - 懒加载 intersectionObserver + getBoundingClientRect
  - 视频只在可视区播放，离屏暂停
  - 快速滚动时暂停资源加载

# 交互

- 骨架屏
- loading
- 加载动画/操作提示/错误提示/form校验
- 防抖节流

# 数据和状态优化

- 最小化全局状态
  - 全局的 mobx 如果依赖的组件过多会导致一些不必要的渲染
  - 关于 mobx class 和 useLocalStore 写法的区别
  - 避免超大全局 store，按业务域拆分 store
- 合理使用 useContext useRef
- 避免不必要的状态更新

# 错误监控和埋点和性能监控

- 全局的错误监控 - 如果用插件Sentry

  ```jsx
   | 错误类型             | 捕获方式                                                | 说明                                 |
  | -------------------- | ------------------------------------------------------- | ------------------------------------ |
  | JS 运行时错误        | `window.onerror`                                        | 捕获语法错误、引用错误、未捕获异常等 |
  | Promise 异常         | `window.onunhandledrejection`                           | 捕获未被 `catch` 的 Promise reject   |
  | 资源加载失败         | `window.addEventListener('error', fn, true)`            | 捕获 img/script/link 等资源加载失败  |
  | Vue/React 框架错误   | Vue: `app.config.errorHandler` <br>React: ErrorBoundary | 捕获组件渲染错误                     |
  | 网络请求失败         | 封装 fetch/axios                                        | 捕获接口请求失败或超时               |
  | 用户行为埋点（可选） | 自定义函数                                              | 捕获用户操作路径，便于复现问题       |

  ```

- 性能监控
  - PerformanceObserver
- 上报策略
  - 通过api
  - navigator.sendBeacon 离开浏览器的时候
  - datalayer+ 浏览器 Google Tag Manager 上报

# 兜底措施/降级措施

- 前端拦截器，错误兜底，超时处理
- websocket 防止断连
- 请求失败时显示默认数据或缓存数据，或者接口返回为空时的处理
- ts对API 返回数据格式校验，避免前端渲染报错
- react的suspense 可以在加载失败的时候展示fallback
- 对关键数据，比如props等设置默认值
- 图片的alt，或者默认展示占位图
  - <img src="..." onError={e => e.target.src='default.png'} />
- try catch 捕获异常 promise.catch
- cdn兜底
- 错误提示什么的/loading等

# 关于 Nginx

- 静态资源缓存（cache-control）
- gzip / brotli 压缩
- 反向代理
- 负载均衡
- HTTPS / HTTP2
- 大文件 Range 支持
