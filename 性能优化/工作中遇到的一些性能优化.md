<!--
 * @Author: error: error: git config user.name & please set dead value or install git && error: git config user.email & please set dead value or install git & please set dead value or install git
 * @Date: 2025-12-11 15:56:27
 * @LastEditors: error: error: git config user.name & please set dead value or install git && error: git config user.email & please set dead value or install git & please set dead value or install git
 * @LastEditTime: 2026-01-16 11:29:42
 * @FilePath: /cjmLearn/性能优化/工作中遇到的一些性能优化.md
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
-->

- 整体来说，我会先通过监控定位瓶颈，再有针对性地在不同阶段做优化，而不是为了优化而优化。

# 背

```jsx
我在做前端性能优化时，一般会从整个请求到渲染的链路来考虑，而不是只针对某一个点。在构建阶段，我会通过代码分割、Tree Shaking 和按需加载来减少首屏包体积，避免把非首屏依赖打进主包。在加载阶段，会重点控制数据量和请求行为，比如避免一次接口返回超大 JSON，对大数据使用流式加载，并在页面切换或快速操作时用 AbortController 取消无效请求，同时做请求去重和缓存。在运行时和渲染阶段，主要关注状态管理和组件渲染效率。比如避免超大的全局状态，按业务拆分 store，精细控制 observer 范围；在 React 中合理使用 useMemo、React.memo，避免 render 中的重复计算和无意义重渲染。在长列表或瀑布流场景，我会使用虚拟列表和资源懒加载，只渲染可视区域，快速滚动时暂停视频和资源加载。最后一定会配合监控，通过性能指标、错误率和用户行为数据来验证优化效果，而不是只凭主观感受。
```

# 关于 mobx

- 全局的 mobx 如果依赖的组件过多会导致一些不必要的渲染
- 关于 mobx class 和 useLocalStore 写法的区别
- 避免超大全局 store，按业务域拆分 store

# 关于加载 json 数据

- 流式加载
- 使用 abortController，切换页面什么的时候，abort 掉，取消加载

# 关于长列表/瀑布流

- 虚拟列表（只渲染可视区）
- 图片 / 视频懒加载（IntersectionObserver + getBoundingClientRect）
- 占位高度预估，避免滚动抖动
- 滚动节流（requestAnimationFrame）
- 视频只在可视区播放，离屏暂停
- 快速滚动时暂停资源加载

# 关于长文件上传/下载

- 分片上传
- 断点续传
- HTTP Range
- fetch API+ ReadableStream

# 关于 js

- 闭包内存泄漏
- 防抖节流
- 定时器/事件清除
- 避免同步阻塞/webworker
- 垃圾回收

# 关于 webpack/vite

- 代码压缩（JS / CSS / 图片）
- Tree Shaking（ESModule、sideEffects）
- 代码分割（路由 / 组件级）
- 按需加载（dynamic import）
- 预加载 / 预取（prefetch / preload）
- 构建缓存（cache-loader / filesystem cache）
- 避免将大依赖打进首包

# 关于 react

- 合理使用 key，避免不必要的 diff
- useMemo / useCallback：避免重复计算和函数重建
- useRef：存储不参与渲染的数据
- React.memo：避免无意义重渲染
- react.lazy + Suspense：代码分割
- startTransition：降低非紧急更新优先级
- 避免 render 中做重计算
- 预加载

# 关于 Nginx

- 静态资源缓存（cache-control）
- gzip / brotli 压缩
- 反向代理
- 负载均衡
- HTTPS / HTTP2
- 大文件 Range 支持

# 浏览器渲染层

- 避免频繁回流 / 重绘
- 合理使用 transform / opacity
- 避免强制同步布局（offsetTop 等）
- 合并 DOM 操作

# 错误监控

- Sentry
- 前端监控 window.onerror,window.onunhandledrejection 等
- 埋点
- 异常监控
