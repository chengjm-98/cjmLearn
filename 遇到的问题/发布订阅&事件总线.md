# 发布订阅

- 发布者（Publisher）：负责发布事件，但不关心谁会订阅。

- 订阅者（Subscriber）：对事件感兴趣，注册回调函数。

- 事件中心（Event Bus / Mediator）：中间人，负责事件分发。

# 发布订阅模式的应用

- 组件间通讯基于react

```jsx
// eventBus.ts
type Handler<T = any> = (data: T) => void

class EventBus {
 private events: Record<string, Handler[]> = {}

 // 订阅事件
 subscribe<T = any>(eventName: string, handler: Handler<T>) {
   if (!this.events[eventName]) {
     this.events[eventName] = []
   }
   this.events[eventName].push(handler)
 }

 // 发布事件
 publish<T = any>(eventName: string, data?: T) {
   const handlers = this.events[eventName]
   if (!handlers) return
   handlers.forEach(fn => fn(data))
 }

 // 取消订阅
 unsubscribe<T = any>(eventName: string, handler: Handler<T>) {
   const handlers = this.events[eventName]
   if (!handlers) return
   this.events[eventName] = handlers.filter(fn => fn !== handler)
 }

 // 清空所有事件
 clear() {
   this.events = {}
 }
}

export default new EventBus()
```

- 自定义hook封装

```js
// useEventBus.ts
import { useEffect } from 'react'
import EventBus from './eventBus'

export function useEventBus<T = any>(eventName: string, handler: (data: T) => void) {
  useEffect(() => {
    EventBus.subscribe(eventName, handler)
    return () => {
      EventBus.unsubscribe(eventName, handler)
    }
  }, [eventName, handler])
}
```

- 组件中使用
- 组件a发布

  ```jsx
  import EventBus from "./eventBus";

  function ComponentA() {
    const handleClick = () => {
      EventBus.publish("login", { name: "Tom", role: "admin" });
    };

    return <button onClick={handleClick}>登录</button>;
  }
  ```

- 组件b订阅

```jsx
import { useEventBus } from "./useEventBus";

function ComponentB() {
  useEventBus("login", (user) => {
    console.log("收到登录信息:", user);
  });

  return <div>Component B</div>;
}
```
