<!--
 * @Author: error: error: git config user.name & please set dead value or install git && error: git config user.email & please set dead value or install git & please set dead value or install git
 * @Date: 2025-12-28 20:49:24
 * @LastEditors: error: error: git config user.name & please set dead value or install git && error: git config user.email & please set dead value or install git & please set dead value or install git
 * @LastEditTime: 2026-01-07 14:39:55
 * @FilePath: /cjmLearn/js/js的基础/深拷贝&浅拷贝/深拷贝&浅拷贝.md
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
-->

# 深拷贝

复制值

```js
const obj = { a: 1, b: { c: 2 } };
const deepCopy = JSON.parse(JSON.stringify(obj));

deepCopy.a = 3;
deepCopy.b.c = 4;

console.log(obj); // { a: 1, b: { c: 2 } }
console.log(deepCopy); // { a: 3, b: { c: 4 } }
```

深拷贝的实现方式有很多，如：

- JSON.parse(JSON.stringify(obj));
- Lodash 的 \_.cloneDeep()
- structuredClone()
- 手动递归

```js
function deepCopy(obj) {
  if (obj === null || typeof obj !== "object") {
    return obj; // 直接返回基本类型或 null
  }

  let copy = Array.isArray(obj) ? [] : {}; // 根据是数组还是对象创建新的拷贝

  for (let key in obj) {
    //hasOwnProperty 用来判断 key 是否是对象“自身的属性”，不包含原型链上的属性。过滤掉原型链上的属性，只复制对象自身的属性。
    if (obj.hasOwnProperty(key)) {
      copy[key] = deepCopy(obj[key]); // 递归拷贝
    }
  }

  return copy;
}

const obj = { a: 1, b: { c: 2 } };
const deepCopyObj = deepCopy(obj);

deepCopyObj.a = 3;
deepCopyObj.b.c = 4;

console.log(obj); // { a: 1, b: { c: 2 } }
console.log(deepCopyObj); // { a: 3, b: { c: 4 } }
```

- proxy

```js
function deepCopyWithProxy(obj) {
  if (obj === null || typeof obj !== "object") return obj;

  return new Proxy(obj, {
    get(target, prop) {
      const value = target[prop];
      // 如果值是对象，则返回一个新的Proxy，如果不是就返回值
      return value && typeof value === "object"
        ? deepCopyWithProxy(value)
        : value;
    },
  });
}

const obj = { a: 1, b: { c: 2 } };
const deepCopyObj = deepCopyWithProxy(obj);

deepCopyObj.b.c = 4;

console.log(obj); // { a: 1, b: { c: 2 } }
console.log(deepCopyObj); // { a: 1, b: { c: 4 } }
```

# 浅拷贝

- 复制引用
  浅拷贝是指仅复制对象的第一层属性，对于嵌套的对象或者数组，仍然保存对原始对象的引用。即对于嵌套的对象，浅拷贝不会复制它们，而是复制它们的引用。

```js
const obj = { a: 1, b: { c: 2 } };
const shallowCopy = { ...obj };

shallowCopy.a = 3;
shallowCopy.b.c = 4;

console.log(obj); // { a: 1, b: { c: 4 } }
console.log(shallowCopy); // { a: 3, b: { c: 4 } }
```

浅拷贝的实现方式有很多，如：

- Object.assign()
- 展开运算符（...）
- Array.slice()
- Array.concat()
