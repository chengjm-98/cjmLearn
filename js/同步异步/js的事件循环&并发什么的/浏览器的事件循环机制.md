<!--
 * @Author: error: error: git config user.name & please set dead value or install git && error: git config user.email & please set dead value or install git & please set dead value or install git
 * @Date: 2025-12-28 20:36:56
 * @LastEditors: error: error: git config user.name & please set dead value or install git && error: git config user.email & please set dead value or install git & please set dead value or install git
 * @LastEditTime: 2025-12-29 22:11:03
 * @FilePath: /cjmLearn/js/同步异步/js的事件循环&并发什么的/浏览器的事件循环机制.md
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
-->

# 事件循环机制

## 为什么要使用事件循环机制？

因为 js 是单线程的，所以需要使用事件循环机制来处理异步任务。

## 事件循环机制的过程

1. 首先执行同步任务，压入调用栈逐一执行。
2. 当调用栈清空后，开始处理异步任务。
3. 异步任务分为微任务（microtasks）和宏任务（macrotasks）：
   - 先执行当前微任务队列中的所有任务。
   - 微任务中可以继续产生新的微任务，这些也会在本轮循环中立即执行，直到微任务队列清空。
4. 微任务队列清空后，浏览器会进行一次页面渲染（如果有变化）。
   - 微任务执行完成后，浏览器会执行渲染操作（如果有的话），如重新绘制页面、更新视图等。
   - 渲染操作的目的是确保用户能够看到最新的界面变化。
5. 然后取出一个宏任务执行（例如：setTimeout、setInterval、DOM 事件）。
6. 宏任务执行过程中如果派生出微任务，则宏任务结束后马上执行这些微任务。
7. 宏任务执行过程中如果派生出宏任务，则将派生出来的宏任务加到宏任务队列尾部，等待之后执行。
8. 重复上述步骤，即构成事件循环（Event Loop）。
   注意：

- 微任务示例：`Promise.then`、`MutationObserver`
- 宏任务示例：`setTimeout`、`setInterval`、`MessageChannel`、`requestAnimationFrame`、`fetch`
