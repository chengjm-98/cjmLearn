<!--
 * @Author: error: error: git config user.name & please set dead value or install git && error: git config user.email & please set dead value or install git & please set dead value or install git
 * @Date: 2025-12-28 20:29:01
 * @LastEditors: error: error: git config user.name & please set dead value or install git && error: git config user.email & please set dead value or install git & please set dead value or install git
 * @LastEditTime: 2025-12-29 01:02:40
 * @FilePath: /cjmLearn/js/同步异步/js的事件循环&并发什么的/同步异步.md
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
-->

# 什么是同步和异步

## 1.同步

- 是指在主线程上排队执行的任务，只有当前任务执行完成后才可以执行下一个任务。**（按照顺序，自上而下）**
- 如果某个任务比较耗时，比如网络请求或者大数据处理，会导致页面卡死或者响应迟缓。

## 2.异步（不是按照顺序，而是按照需求，时机）

- 是指不进入主线程，而进入任务队列的任务，只有当任务队列通知主线程某个异步任务可以执行，方可进入主线程进行执行。

## 为什么会出现异步问题

- 1.js 是单线程语言，同时只能做一件事情
- 2.为了在执行的时候不阻塞后续代码执行，通常使用异步操作
- 3.通过事件循环实现异步

## 异步机制

- 任务队列，异步任务需要有一个任务队列。

### **总的来说，JavaScript 的异步机制包括以下几个步骤（简单版）**

- （1）所有同步任务都在主线程上执行，行成一个执行栈
- （2）主线程之外，还存在一个任务队列，只要异步任务有了结果，就会在任务队列中放置一个事件
- （3）一旦执行栈中的所有同步任务执行完毕，系统就会读取任务队列，看看里面还有哪些事件，那些对应的异步任务，于是结束等待状态，进入执行栈，开始执行
- （4）主线程不断的重复上面的第三步

## 异步任务的分类

- 宏任务
- 较低优先级的任务（如 setTimeout、requestAnimationFrame、requestIdleCallback），会在执行完所有微任务后按顺序执行。
- 微任务
  - 优先级较高的异步任务（如 Promise），在事件循环中会先执行。
- 动画任务

## 实现异步任务的几种方式

- 回调函数
- Promise （链式调用）
- async/await （promise 的语法糖）
- 定时器
- 事件监听
- 消息队列
- 消息订阅与发布
- ......

## 回调函数的 this 指向问题

- 普通函数的 this 指向全局对象
- 箭头函数没有自己的 this，它会继承外部上下文的 this。

## requestAnimationFrame 和 requestIdleCallback

### requestAnimationFrame 和 事件循环：

requestAnimationFrame 会在浏览器的每一帧中执行，通常在渲染前调用，确保动画平滑。

它是一个 宏任务，但其优先级高于其他普通的宏任务，如 setTimeout，因为它与浏览器的帧率同步。

### requestIdleCallback 和 事件循环：

requestIdleCallback 会在浏览器空闲时执行，即在所有同步任务（微任务）和关键渲染任务完成后。

它是一个 低优先级宏任务，不会影响页面的渲染，通常用于延迟执行不紧急的后台任务。
